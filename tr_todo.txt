RESEARCH ---------------------------------------------------------------------

- how does harfbuzz select charmap?


FEATURES / NOW ---------------------------------------------------------------

- BUG: line wrapping: remove last logical space of last word on the line.

- BUG/RTL: sub-segments don't work on RTL runs.

- BUG: segment.text_run is that of last sub-segment: sometimes this is a bad
	choice eg. with `nowrap` on {nowrap=true, 'a b'},' c' which creates
	segments 'a ','b ','c' but sub-segments 'a','b',' ','c'
	where ' ' has nowrap=false.
	- same problem with selecting `paragraph_spacing`
	- need a way to distribute enclosing attributes like `p` to text_runs.

- lines:relayout(w, h, valign, halign)

- follow tabstops (for codedit)

- halign: justify:
	- distribute whitespace uniformly, including cursor positions.


LATER ------------------------------------------------------------------------

- underline / strikethrough (for accelerators and links):
	- color, thickness, style (single, double, wavy, image), dashes.

- font baseline modifiers:
	- raise, subscript, superscript, sub, sup

- font size modifiers:
	- %size, big, small

- font_db selector: stretch/condensed...

- p attribute.
	- for now: use PS (makes text more portable too).

- text_run.dir attribute which also splits a segment.
	- for now: enclose text in LRI/PDF or RLI/PDF.
		- downside: unlike markup, bidi markers don't cross paragraph boundaries.

- glyph substitution:
	- font_override text attribute for manual override.
	- register fallback fonts for script/language and try them in order.
	- match original font's size, weight, slant, stretch.
	- cache the substitutions.


EVEN LATER -------------------------------------------------------------------

- opacity:
	- apply on the whole run
		- optimize to only do that if the glyphs are ligated (how can we know?)

- vertical alignment top/bottom margins option:
	- ascent/descent
	- spacing_ascent/spacing_descent
	- paragraph_ascent/paragraph_descent

- html-like markup parser with tags, attributes and escapes.
	- how is it better than serialized Lua which is syntax-highlighted in code
	and can be built iteratively without string concatenation?

- font lrucache instead of ref-counting.
	- use two caches: count-limited mmapped fonts and size-limited heap fonts.


ADVANCED LAYOUTING -----------------------------------------------------------

- vertical layouts:
	- gravity, gravity_hint?

- bug: shaping words separately breaks contextual ligatures.
	- see: https://bugzilla.mozilla.org/show_bug.cgi?id=761442
	- there's talk about a harfbuzz "context" option but I can't see it.
	- this also disables some advanced features such as word kerning and
	collision avoidance.

- allow varying the formatting attributes within a single grapheme, IOW
allow coloring the diacritical marks differently than the base glyph.

- underline to skip descenders:
	- fast outline intersection algorithm + caching the results.

- knuth's line wrapping algorithm.

- hyphenation: https://github.com/hunspell/hyphen (what libreoffice uses)
	- mandatory for word-wrapping of east-asian scripts with no spaces between
	words (Thai, Lao, Khmer, Burmese, etc.)
		- word caching would need to be disabled for those scripts as well.

- letter spacing:
	- identify breaking points (see HB_UNSAFE_TO_BREAK_HERE flag).
	- adjust justification algorithm to include letter spacing.

- line wrapping inside an arbitrary enclosure (path).

- text rotation at arbitrary angles using rotated outlines:
	- convert glyph runs to cairo path objects and rasterize with cairo.

- arbitrary path baseline (eg. for names on maps):
	- same breaking points as for letter-spacing.
	- translate & rotate glyphs to match path's normals at glyph's center.

- advanced arbitrary path baseline (i.e. distorted glyphs):
	- extract glyphs outlines
	- break outlines into polygons
	- distort points based on path's normal vectors
	- rasterize new distorted outline

- horizontal alignment and line wrapping which excludes side bearings.
	- diff. for RTL and LTR lines and doesn't "just work" for mixed lines
	because bidi reordering happens after line breaking so it's not known
	which segments will be first/last when doing line wrapping.

EDITING ----------------------------------------------------------------------

- insert mode cursor

- IME integration

- unicode debugging / visual editing aids:

	- show hex boxes for:
		- invalid bytes
		- missing glyphs
		- control characters

	- mark invisible characters positions:
		- ZW-NBSP: prevents ligatures
		- NBSP: prevents word-wrapping
		- SOFT HYPHEN: hyphenate if word-wrapping
		- ZWJ: force joining
		- ZWNJ: prevent joining
		- WORD JOINER: ZW-NBSP-like
		- LTR/RTL modifiers
		- variation selectors
		- hangul fillers

	- mark look-alike characters:   ; ꓸ ꓹ ꓽ

	- mark runs by script and language

	- spell checking: upgrade hunspell and integrate it:
		- highlighting, autocompletion, autocorrection, autoignore, manual ignore.

	- cursor:
		- show direction
		- show all codepoints individually between cursor and next cursor
		- shape/show all graphemes individually between cursor and next cursor

